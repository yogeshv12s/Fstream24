<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Play Files</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<style>
  html, body { margin:0; height:100%; background:black; }
  #stream-media { width:100%; height:100%; background:black; display:block; }

  #error-message { color:red; font-size:24px; text-align:center; margin-top:20px; }

  /* Watermark */
  .mejs-watermark {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 80px;
    opacity: 0.6;
    z-index: 1000;
    pointer-events: none;
  }

  /* Bottom Control Bar */
  #control-bar {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0,0,0,0.6);
    display: flex;
    align-items: center;
    padding: 5px 10px;
    z-index: 1000;
    flex-wrap: wrap;
  }

  #control-bar i {
    color: white;
    font-size: 20px;
    cursor: pointer;
    margin-right: 10px;
  }

  #progress-container {
    flex: 1;
    height: 5px;
    background: rgba(255,255,255,0.3);
    border-radius: 3px;
    cursor: pointer;
    margin: 0 10px;
    position: relative;
  }

  #progress {
    height: 5px;
    background: #ff0000;
    width: 0%;
    border-radius: 3px;
  }

  #time-display {
    color:white;
    font-size:14px;
    white-space: nowrap;
  }

  /* Top Custom Buttons */
  .custom-button {
    position: absolute;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    text-align: center;
    line-height: 40px;
    color: white;
    background-color: rgba(0,0,0,0.7);
    z-index: 1000;
    cursor: pointer;
    font-family: "Font Awesome 5 Free";
    font-weight: 900;
    font-size: 18px;
    transition: 0.3s;
  }
  .custom-button:hover { background-color: rgba(255,255,255,0.7); color:black; }

  /* Preloader with sketch logo */
  #preloader {
    position: fixed;
    inset: 0;
    background: black;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    opacity: 1;
    transition: opacity 1s ease;
    flex-direction: column;
  }
  #preloader.fade-out { opacity: 0; pointer-events: none; }

  #preloader img {
    width: 180px;
    filter: grayscale(100%) contrast(200%);
    opacity: 0;
    animation: sketch 4s forwards ease-in-out;
    margin-top: 24px;
  }

  /* Spinner Loader */
  #spinner {
    width: 48px;
    height: 48px;
    border: 5px solid #fff;
    border-top: 5px solid #ff0000;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 10px;
    opacity: 0.8;
  }
  @keyframes spin {
    0% { transform: rotate(0deg);}
    100% { transform: rotate(360deg); }
  }

  @keyframes sketch {
    0% { opacity: 0; filter: grayscale(100%) blur(5px); }
    50% { opacity: 0.5; filter: grayscale(50%) blur(2px); }
    100% { opacity: 1; filter: grayscale(0%) blur(0); }
  }

  /* Big Play Button */
  #big-play {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 70px;
    color: white;
    background: rgba(0,0,0,0.5);
    border-radius: 50%;
    padding: 20px;
    cursor: pointer;
    z-index: 1500;
    transition: 0.3s;
  }
  #big-play:hover { background: rgba(255,255,255,0.7); color: black; }

  /* Toast Notification */
  #toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 12px 18px;
    border-radius: 8px;
    font-size: 14px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease;
    z-index: 3000;
  }
  #toast.show { opacity: 1; }

  /* Responsive */
  @media(max-width:768px){
    .mejs-watermark { width: 60px; }
    .custom-button { width: 30px; height: 30px; line-height:30px; font-size:14px; }
    #control-bar i { font-size:16px; margin-right:5px; }
    #big-play { font-size:50px; padding:15px; }
  }
  @media(min-width:1200px){
    .mejs-watermark { width: 100px; }
    .custom-button { width: 45px; height: 45px; line-height:45px; font-size:20px; }
    #control-bar i { font-size:22px; margin-right:10px; }
  }
</style>
</head>
<body>

<!-- Preloader with sketch logo -->
<div id="preloader">
  <div id="spinner"></div>
  <img src="https://chadstreamz.sbs/assets/images/log2.png" alt="Logo">
</div>

<video id="stream-media" preload="auto"></video>
<div id="error-message"></div>

<!-- Big Play -->
<div id="big-play"><i class="fas fa-play"></i></div>

<!-- Toast -->
<div id="toast">You can download this video</div>

<script>
var mediaLink = "{{ mediaLink }}"; // replace with your media URL

if(mediaLink){

  // Ask user: Play or Download
  setTimeout(()=> {
    let choice = confirm("Do you want to PLAY the video?\nClick Cancel to DOWNLOAD.");
    if(choice){
      initPlayer(); // user chose to play
    } else {
      // Trigger download
      var a = document.createElement('a'); a.href=mediaLink; a.download=''; document.body.appendChild(a); a.click(); document.body.removeChild(a);
    }
  }, 100);

  function initPlayer(){
    var video = document.getElementById('stream-media');
    video.src = mediaLink;
    var preloader = document.getElementById("preloader");
    var bigPlay = document.getElementById("big-play");
    var toast = document.getElementById("toast");

    // Preloader fade out
    video.addEventListener("canplaythrough", function() {
      setTimeout(()=>preloader.classList.add("fade-out"), 500);
    });

    // Big play overlay
    bigPlay.onclick = function(){
      video.play();
      bigPlay.style.display="none";
      bottomPlay.className='fas fa-pause';
      playBtn.innerHTML='<i class="fas fa-pause"></i>';
    };
    video.addEventListener("play", ()=>bigPlay.style.display="none");

    // Toast every 20 sec
    setInterval(function(){
      toast.classList.add("show");
      setTimeout(()=>toast.classList.remove("show"), 4000);
    }, 20000);

    // --- Top Buttons ---
    function createButton(iconClass, top, left, onClick){
      var btn = document.createElement('div');
      btn.className = 'custom-button';
      btn.style.top = top+'px';
      btn.style.left = left+'px';
      btn.innerHTML = '<i class="'+iconClass+'"></i>';
      btn.onclick = onClick;
      document.body.appendChild(btn);
      return btn;
    }

    // Play/Pause top
    var playBtn = createButton('fas fa-play', 10, 10, function(){
      if(video.paused){ video.play(); playBtn.innerHTML='<i class="fas fa-pause"></i>'; bottomPlay.className='fas fa-pause'; }
      else { video.pause(); playBtn.innerHTML='<i class="fas fa-play"></i>'; bottomPlay.className='fas fa-play'; }
    });

    // Volume top
    var volumeBtn = createButton('fas fa-volume-up', 60, 10, function(){
      if(video.muted){ video.muted=false; volumeBtn.innerHTML='<i class="fas fa-volume-up"></i>'; }
      else { video.muted=true; volumeBtn.innerHTML='<i class="fas fa-volume-mute"></i>'; }
    });

    // Fullscreen top
    var fullscreenBtn = createButton('fas fa-expand', 110, 10, function(){
      if(!document.fullscreenElement){ video.requestFullscreen(); fullscreenBtn.innerHTML='<i class="fas fa-compress"></i>'; }
      else { document.exitFullscreen(); fullscreenBtn.innerHTML='<i class="fas fa-expand"></i>'; }
    });

    // Download top
    createButton('fas fa-download', 160, 10, function(){
      var a = document.createElement('a'); a.href=mediaLink; a.download=''; document.body.appendChild(a); a.click(); document.body.removeChild(a);
    });

    // Share top
    createButton('fas fa-share', 210, 10, function(){
      if(navigator.share){ navigator.share({ title:"Play", url: mediaLink }); }
    });

    // Watermark
    var watermark = document.createElement('img');
    watermark.src = 'https://chadstreamz.sbs/assets/images/log2.png';
    watermark.className = 'mejs-watermark';
    document.body.appendChild(watermark);

    // --- Bottom Control Bar ---
    var controlBar = document.createElement('div');
    controlBar.id = 'control-bar';
    document.body.appendChild(controlBar);

    // Play/Pause bottom
    var bottomPlay = document.createElement('i'); bottomPlay.className='fas fa-play'; controlBar.appendChild(bottomPlay);
    bottomPlay.onclick = function(){
      if(video.paused){ video.play(); bottomPlay.className='fas fa-pause'; playBtn.innerHTML='<i class="fas fa-pause"></i>'; }
      else { video.pause(); bottomPlay.className='fas fa-play'; playBtn.innerHTML='<i class="fas fa-play"></i>'; }
    };

    // Progress bar
    var progressContainer = document.createElement('div'); progressContainer.id='progress-container';
    var progress = document.createElement('div'); progress.id='progress'; progressContainer.appendChild(progress);
    controlBar.appendChild(progressContainer);

    let isDragging = false;
    function updateProgress(e){
      var rect = progressContainer.getBoundingClientRect();
      var clientX = e.clientX ?? (e.touches ? e.touches[0].clientX : 0);
      var pos = Math.min(Math.max(0, clientX - rect.left), rect.width) / rect.width;
      video.currentTime = pos * video.duration;
    }

    progressContainer.addEventListener('pointerdown', (e) => { isDragging = true; updateProgress(e); video.pause(); progressContainer.setPointerCapture(e.pointerId); });
    progressContainer.addEventListener('pointermove', (e) => { if(isDragging) updateProgress(e); });
    progressContainer.addEventListener('pointerup', (e) => { if(isDragging){ updateProgress(e); isDragging=false; video.play(); } });

    // Time display
    var timeDisplay = document.createElement('span'); timeDisplay.id='time-display'; timeDisplay.textContent='00:00 / 00:00';
    controlBar.appendChild(timeDisplay);

    video.addEventListener('timeupdate', function(){
      if(!isDragging){
        var percent = (video.currentTime / video.duration) * 100;
        progress.style.width = percent + '%';
      }
      function formatTime(t){ var m=Math.floor(t/60).toString().padStart(2,'0'); var s=Math.floor(t%60).toString().padStart(2,'0'); return m+':'+s; }
      timeDisplay.textContent = formatTime(video.currentTime)+' / '+formatTime(video.duration);
    });
  }

}else{
  document.getElementById('error-message').textContent = 'Error: Media URL not provided';
}
</script>
</body>
</html>
