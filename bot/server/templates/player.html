<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Netflix Style Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<style>
  /* General Styles */
  html, body { margin:0; height:100%; background:black; font-family: Arial, sans-serif; overflow:hidden; }
  #player-container { position: relative; width:100%; height:100%; background:black; display:flex; align-items:center; justify-content:center; }

  video { width:100%; height:100%; object-fit:cover; background:black; }

  /* Preloader */
  #preloader { position: fixed; inset:0; background:black; display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:2000; transition:0.8s opacity; }
  #preloader.fade-out { opacity:0; pointer-events:none; }
  #spinner { width:50px; height:50px; border:5px solid #fff; border-top:5px solid #e50914; border-radius:50%; animation:spin 1s linear infinite; margin-bottom:15px; }
  @keyframes spin { 0%{transform:rotate(0deg);}100%{transform:rotate(360deg);} }

  #preloader img { width:180px; filter:grayscale(100%) contrast(200%); opacity:0; animation:logoFade 3s forwards; }
  @keyframes logoFade { 0%{opacity:0; transform:scale(0.5);}50%{opacity:0.5; transform:scale(1.1);}100%{opacity:1; transform:scale(1);} }

  /* Big Play Button */
  #big-play { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:70px; color:white; background:rgba(0,0,0,0.6); border-radius:50%; padding:20px; cursor:pointer; z-index:1500; transition:0.3s; }
  #big-play:hover { background: rgba(255,255,255,0.8); color:black; }

  /* Watermark */
  .watermark { position:absolute; top:10px; right:10px; width:100px; opacity:0.6; pointer-events:none; z-index:1000; }

  /* Top Control Buttons */
  .top-btn { position:absolute; top:10px; width:45px; height:45px; line-height:45px; border-radius:50%; text-align:center; color:white; background:rgba(0,0,0,0.7); cursor:pointer; font-size:20px; z-index:1000; transition:0.3s; }
  .top-btn:hover { background:rgba(255,255,255,0.8); color:black; }

  /* Bottom Control Bar */
  #control-bar { position:absolute; bottom:0; left:0; right:0; height:60px; background:rgba(0,0,0,0.6); display:flex; align-items:center; padding:0 20px; z-index:1000; }
  #control-bar i { color:white; font-size:22px; margin-right:15px; cursor:pointer; transition:0.2s; }
  #control-bar i:hover { color:#e50914; }
  #progress-container { flex:1; height:6px; background:rgba(255,255,255,0.3); border-radius:3px; margin:0 15px; position:relative; cursor:pointer; }
  #progress { height:6px; background:#e50914; width:0%; border-radius:3px; }
  #time-display { color:white; font-size:14px; white-space:nowrap; }

  /* Toast */
  #toast { position:fixed; bottom:20px; right:20px; background:rgba(0,0,0,0.8); color:white; padding:12px 18px; border-radius:8px; font-size:14px; opacity:0; pointer-events:none; transition:0.5s; z-index:3000; }
  #toast.show { opacity:1; }

  /* Popup */
  #popup-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.7); display:flex; justify-content:center; align-items:center; z-index:4000; }
  #popup-box { background:#111; padding:30px; border-radius:12px; text-align:center; color:white; max-width:350px; }
  #popup-box h2 { margin-bottom:25px; font-size:20px; }
  #popup-box button { padding:12px 25px; margin:0 10px; border:none; border-radius:6px; font-size:16px; cursor:pointer; transition:0.3s; }
  #popup-box button#play-btn { background:#e50914; color:white; }
  #popup-box button#download-btn { background:#007bff; color:white; }
  #popup-box button:hover { opacity:0.8; }

  /* Responsive */
  @media(max-width:768px){
    .watermark{width:60px;}
    .top-btn{width:35px;height:35px;line-height:35px;font-size:16px;}
    #big-play{font-size:50px;padding:15px;}
    #control-bar i{font-size:18px;margin-right:10px;}
    #popup-box{padding:20px;}
  }
</style>
</head>
<body>

<div id="player-container">
  <video id="stream-media" preload="auto"></video>
  <div id="error-message" style="color:red;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:24px;"></div>
  <div id="big-play"><i class="fas fa-play"></i></div>
  <img class="watermark" src="https://chadstreamz.sbs/assets/images/log2.png">
</div>

<!-- Toast -->
<div id="toast">You can download this video</div>

<!-- Preloader -->
<div id="preloader">
  <div id="spinner"></div>
  <img src="https://chadstreamz.sbs/assets/images/log2.png" alt="Logo">
</div>

<!-- Popup -->
<div id="popup-overlay">
  <div id="popup-box">
    <h2>Do you want to Play or Download?</h2>
    <button id="play-btn">Play</button>
    <button id="download-btn">Download</button>
  </div>
</div>

<script>
var mediaLink = "{{ mediaLink }}"; // Your media URL here

if(mediaLink){
  const popup = document.getElementById('popup-overlay');
  const playBtnPopup = document.getElementById('play-btn');
  const downloadBtnPopup = document.getElementById('download-btn');

  playBtnPopup.onclick = function(){
    popup.style.display='none';
    initPlayer();
  };

  downloadBtnPopup.onclick = function(){
    const a = document.createElement('a'); a.href=mediaLink; a.download=''; document.body.appendChild(a); a.click(); document.body.removeChild(a);
  };

  function initPlayer(){
    const video = document.getElementById('stream-media');
    video.src = mediaLink;
    const preloader = document.getElementById("preloader");
    const bigPlay = document.getElementById("big-play");
    const toast = document.getElementById("toast");

    // Preloader
    video.addEventListener("canplaythrough", ()=>{ setTimeout(()=>preloader.classList.add("fade-out"),500); });

    bigPlay.onclick = ()=>{ video.play(); bigPlay.style.display='none'; };

    setInterval(()=>{ toast.classList.add("show"); setTimeout(()=>toast.classList.remove("show"),4000); }, 20000);

    // Top buttons
    function createTopBtn(icon, top, left, callback){
      const btn = document.createElement('div');
      btn.className='top-btn';
      btn.style.top=top+'px'; btn.style.left=left+'px';
      btn.innerHTML='<i class="'+icon+'"></i>';
      btn.onclick=callback;
      document.body.appendChild(btn);
      return btn;
    }

    const topPlayBtn = createTopBtn('fas fa-play',10,10,()=>{
      if(video.paused){ video.play(); topPlayBtn.innerHTML='<i class="fas fa-pause"></i>'; bottomPlay.className='fas fa-pause'; }
      else { video.pause(); topPlayBtn.innerHTML='<i class="fas fa-play"></i>'; bottomPlay.className='fas fa-play'; }
    });
    const volumeBtn = createTopBtn('fas fa-volume-up',60,10,()=>{
      video.muted = !video.muted;
      volumeBtn.innerHTML = video.muted ? '<i class="fas fa-volume-mute"></i>' : '<i class="fas fa-volume-up"></i>';
    });
    const fullscreenBtn = createTopBtn('fas fa-expand',110,10,()=>{
      if(!document.fullscreenElement){ video.requestFullscreen(); fullscreenBtn.innerHTML='<i class="fas fa-compress"></i>'; }
      else { document.exitFullscreen(); fullscreenBtn.innerHTML='<i class="fas fa-expand"></i>'; }
    });
    createTopBtn('fas fa-download',160,10,()=>{ const a=document.createElement('a'); a.href=mediaLink; a.download=''; document.body.appendChild(a); a.click(); document.body.removeChild(a); });
    createTopBtn('fas fa-share',210,10,()=>{ if(navigator.share){ navigator.share({title:"Play", url: mediaLink}); } });

    // Bottom control bar
    const controlBar = document.createElement('div'); controlBar.id='control-bar'; document.body.appendChild(controlBar);
    const bottomPlay = document.createElement('i'); bottomPlay.className='fas fa-play'; controlBar.appendChild(bottomPlay);
    bottomPlay.onclick = ()=>{ if(video.paused){ video.play(); bottomPlay.className='fas fa-pause'; topPlayBtn.innerHTML='<i class="fas fa-pause"></i>'; } else { video.pause(); bottomPlay.className='fas fa-play'; topPlayBtn.innerHTML='<i class="fas fa-play"></i>'; } };

    const progressContainer = document.createElement('div'); progressContainer.id='progress-container';
    const progress = document.createElement('div'); progress.id='progress'; progressContainer.appendChild(progress);
    controlBar.appendChild(progressContainer);

    let dragging=false;
    function updateProgress(e){
      const rect = progressContainer.getBoundingClientRect();
      const clientX = e.clientX ?? (e.touches? e.touches[0].clientX:0);
      const pos = Math.min(Math.max(0, clientX - rect.left), rect.width)/rect.width;
      video.currentTime = pos*video.duration;
    }
    progressContainer.addEventListener('pointerdown', e=>{ dragging=true; updateProgress(e); video.pause(); progressContainer.setPointerCapture(e.pointerId); });
    progressContainer.addEventListener('pointermove', e=>{ if(dragging) updateProgress(e); });
    progressContainer.addEventListener('pointerup', e=>{ if(dragging){ updateProgress(e); dragging=false; video.play(); } });

    const timeDisplay = document.createElement('span'); timeDisplay.id='time-display'; timeDisplay.textContent='00:00 / 00:00'; controlBar.appendChild(timeDisplay);
    video.addEventListener('timeupdate', ()=>{
      if(!dragging) progress.style.width = (video.currentTime/video.duration)*100+'%';
      function formatTime(t){ const m=Math.floor(t/60).toString().padStart(2,'0'); const s=Math.floor(t%60).toString().padStart(2,'0'); return m+':'+s; }
      timeDisplay.textContent = formatTime(video.currentTime)+' / '+formatTime(video.duration);
    });
  }
}else{
  document.getElementById('error-message').textContent='Error: Media URL not provided';
}
</script>
</body>
</html>
